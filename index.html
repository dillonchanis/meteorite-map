<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Meteorite Landings</title>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.3.0/d3.min.js"></script>
	</head>
	<body>
	
		<script>

			var width = 960;
			var height = 600;

			var projection = d3.geoEquirectangular()
				.translate([width/2, height/2])
				.scale(height / Math.PI);

			var path = d3.geoPath().projection(projection);

			var svg = d3.select("body").append("svg")
				.attr("width", width)
				.attr("height", height);

				var g = svg.append("g");


			svg.append("rect")
		    .attr("width", width)
		    .attr("height", height)
		    .style("fill", "none")
		    .style("pointer-events", "all")
		    .call(d3.zoom()
		        .scaleExtent([1, 8])
		        .on("zoom", zoomed));

			function zoomed() {
				g.attr("transform", d3.event.transform);
			}

			d3.json("world.json", function(json) {

				g.selectAll("path")
					.data(json.features)
					.enter()
					.append("path")
					.attr("d", path)
					.attr("stroke", "#000")
					.attr("fill", "#999");

				d3.csv("Meteorite_Landings.csv", function(data) {

					var meteors = filterMeteors(data);

					g.selectAll("circle")
						.data(data)
						.enter()
						.append("circle")
						.attr("cx", function(meteors) {
							if(projection([meteors.reclong, meteors.reclat])) {
								return projection([meteors.reclong, meteors.reclat])[0]; 
							}
						})
						.attr("cy", function(meteors) {
							if(projection([meteors.reclong, meteors.reclat])){
								return projection([meteors.reclong, meteors.reclat])[1];
							}
						})
						.attr("r", function(meteors) {
							if(meteors["mass (g)"]){
								return Math.sqrt(parseInt(meteors["mass (g)"]) * 0.00005);
							}
						})
						.attr("fill", "red");

				});

			});

			//Returns meteors that have GeoLocation data attached to them
			function filterMeteors(data) {
				return data.map(function(data) {
					if(data.reclong !== 0 && data.reclat !== 0) {
						return data;
					}
				});
			}

		</script>
	
	</body>
</html>